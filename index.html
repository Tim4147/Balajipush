<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Balaji365 Push Panel</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: 2em auto; padding: 0 1em; }
    h1, h2 { margin-top: 1.5em; }
    .form-group { margin-bottom: 1em; }
    input, textarea, button, select { width: 100%; padding: 0.6em; margin-top: 0.3em; }
    button { background: #1a202c; color: white; border: none; cursor: pointer; border-radius: 4px; }
    .template { border: 1px solid #ccc; padding: 0.6em; margin-bottom: 0.6em; display: flex; justify-content: space-between; align-items: center; }
    .ok { color:#0a7f00; } .err { color:#b00020; }
  </style>
</head>
<body>
  <h1>Balaji365 Manual Push Panel</h1>

  <div class="form-group">
    <label>Admin API URL</label>
    <!-- Correct account subdomain -->
    <input id="apiUrl" value="https://balaji365-admin.btim4147.workers.dev" />
  </div>

  <div class="form-group">
    <label>Admin Secret (Bearer)</label>
    <input id="secret" type="password" placeholder="Enter admin secret" />
    <p style="font-size:0.9em;color:#555;">Stored only in your browser (localStorage) for convenience.</p>
  </div>

  <h2>Send Custom Push</h2>
  <div class="form-group">
    <label>Title</label>
    <input id="cTitle" maxlength="60" placeholder="Type push title…" />
  </div>
  <div class="form-group">
    <label>Body</label>
    <textarea id="cBody" maxlength="120" rows="3" placeholder="Type push body…"></textarea>
  </div>
  <button onclick="sendCustom()">Send Custom Push</button>
  <div id="cResp" class="ok" style="margin-top:0.5em;"></div>

  <h2>Send a Casino Template</h2>
  <button onclick="loadBank()">Load Templates</button>
  <div id="bank" style="margin-top:1em;"></div>
  <div id="bResp" class="err"></div>

  <h2>Send Sports Push</h2>
  <div class="form-group">
    <label>Team 1</label><input id="sT1" placeholder="e.g., India" />
  </div>
  <div class="form-group">
    <label>Team 2</label><input id="sT2" placeholder="e.g., Pakistan" />
  </div>
  <div class="form-group">
    <label>Time (optional, e.g., 19:30)</label><input id="sWhen" placeholder="Optional time" />
  </div>
  <button onclick="sendSports()">Send Sports Push</button>
  <div id="sResp" class="ok" style="margin-top:0.5em;"></div>

<script>
/* ---- remember URL & secret locally ---- */
const urlInput = document.getElementById('apiUrl');
const secInput = document.getElementById('secret');
const savedUrl = localStorage.getItem('balaji_api_url');
const savedSec = localStorage.getItem('balaji_admin_secret');
if (savedUrl) urlInput.value = savedUrl;
if (savedSec) secInput.value = savedSec;
urlInput.addEventListener('input', e => localStorage.setItem('balaji_api_url', e.target.value.trim()));
secInput.addEventListener('input', e => localStorage.setItem('balaji_admin_secret', e.target.value.trim()));

function getConfig() {
  const apiUrl = urlInput.value.trim();
  const secret = secInput.value.trim();
  if (!apiUrl || !secret) {
    alert('Please fill in Admin API URL and Admin Secret.');
    throw new Error('Missing config');
  }
  return { apiUrl, secret };
}

async function sendCustom() {
  try {
    const { apiUrl, secret } = getConfig();
    const title = document.getElementById('cTitle').value.trim();
    const body  = document.getElementById('cBody').value.trim();
    const res = await fetch(apiUrl + '/send-push', {
      method: 'POST',
      headers: { 'Authorization': 'Bearer ' + secret, 'Content-Type': 'application/json' },
      body: JSON.stringify({ title, body })
    });
    document.getElementById('cResp').textContent = 'Response: ' + res.status;
    if (!res.ok) throw new Error('Failed: ' + res.status);
  } catch (e) {
    document.getElementById('cResp').className = 'err';
    document.getElementById('cResp').textContent = e.message;
  }
}

async function loadBank() {
  const bResp = document.getElementById('bResp');
  bResp.textContent = '';
  try {
    const { apiUrl, secret } = getConfig();
    const res = await fetch(apiUrl + '/bank', { headers: { 'Authorization': 'Bearer ' + secret } });
    if (!res.ok) throw new Error('Failed: ' + res.status);
    const bank = await res.json();
    const container = document.getElementById('bank');
    container.innerHTML = '';
    const templates = [...(bank.slots?.afternoon || []), ...(bank.slots?.night || [])].filter(t => t.enabled);
    if (!templates.length) container.innerHTML = '<p>No templates found.</p>';
    for (const t of templates) {
      const div = document.createElement('div');
      div.className = 'template';
      const label = document.createElement('div');
      label.innerHTML = `<strong>${escapeHTML(t.title)}</strong><br/><small>${escapeHTML(t.body)}</small>`;
      const btn = document.createElement('button');
      btn.innerText = 'Send';
      btn.onclick = async () => {
        const resp = await fetch(apiUrl + '/send-casino', {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + secret, 'Content-Type': 'application/json' },
          body: JSON.stringify({ id: t.id })
        });
        alert(`Sent "${t.title}" → ${resp.status}`);
      };
      div.append(label, btn);
      container.appendChild(div);
    }
  } catch (e) {
    bResp.textContent = e.message + ' (Check CORS_ORIGIN & secret)';
  }
}

async function sendSports() {
  try {
    const { apiUrl, secret } = getConfig();
    const team1 = document.getElementById('sT1').value.trim();
    const team2 = document.getElementById('sT2').value.trim();
    const when  = document.getElementById('sWhen').value.trim();
    const res = await fetch(apiUrl + '/send-sports', {
      method: 'POST',
      headers: { 'Authorization': 'Bearer ' + secret, 'Content-Type': 'application/json' },
      body: JSON.stringify({ team1, team2, when })
    });
    document.getElementById('sResp').textContent = 'Response: ' + res.status;
    if (!res.ok) throw new Error('Failed: ' + res.status);
  } catch (e) {
    document.getElementById('sResp').className = 'err';
    document.getElementById('sResp').textContent = e.message;
  }
}

function escapeHTML(str) {
  return (str || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
</script>
</body>
</html>
